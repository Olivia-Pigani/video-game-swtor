package org.example;

import org.example.models.Jedi;
import org.example.models.Sith;
import org.example.models.Team;
import org.example.models.factories.ForceUser;
import org.example.services.characters.ForceUserService;

import java.sql.SQLException;
import java.util.List;
import java.util.Scanner;

public class IHM {

    private  Scanner scanner = new Scanner(System.in);
    private static boolean run = true;

    private ForceUserService forceUserService;

    private static int choice;


    public IHM(Scanner scanner, ForceUserService forceUserService) {
        this.scanner = scanner;
        this.forceUserService = forceUserService;
    }

    public void printMenu() throws SQLException {
        System.out.println("""
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠶⠶⠿⢿⣿⣿⣿⣿⣷⣶⣶⣶⣤⣤⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣴⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠛⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠛⠛⠋⠛⠛⠻⢿⣿⣿⣿⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⣠⣴⣾⣿⣿⣿⣷⣶⣤⡈⠙⢿⣿⣿⣿⣿⣿⣄⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⢀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠙⢿⣿⣿⣿⣿⣆⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣤⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠁⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠈⢻⣿⣿⣿⣿⣧⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠈⢿⣿⣿⣿⣿⣇⠀⠀
                ⠀⠀⠀⠀⠀⠀⣤⣤⣤⣤⣤⣤⣤⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⠀⣿⣿⣿⣿⣿⣿⡿⢿⣿⣿⣿⣿⣿⣿⣿⣿⡆⢸⣿⣿⣿⣿⣿⡄⠀
                ⠀⠀⠀⠀⠀⠀⠉⠉⠉⠉⠉⠙⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⢹⣿⣿⣿⣿⣿⣆⣠⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣷⠀
                ⠀⠀⢰⣶⡆⠀⠀⠀⠀⢀⣀⣀⣹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⡀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⢰⣿⣿⣿⣿⣿⣿⡆
                ⢀⠀⢸⣿⣧⣰⣶⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⡀⠹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀⣾⣿⣿⣿⣿⣿⣿⣇
                ⣿⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡈⠛⢿⣿⣿⣿⣿⣿⣿⣿⣿⠟⢀⣼⣿⣿⣿⣿⣿⣿⣿⣿
                ⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣤⣈⠉⠛⠛⠛⠛⢉⣠⣴⣿⣿⣿⣿⣿⣿⣿⣿⡿⢋
                ⣶⣌⡛⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠟⣋⣥⣾⡿
                ⠙⢿⣿⣷⣶⣬⣙⡛⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠟⢛⣉⣥⣴⣾⣿⣿⣿⣿⡇
                ⠀⠀⠙⣿⡟⢿⣿⣿⣿⣷⣶⣦⣬⣭⣉⣙⣛⣛⠛⠻⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠛⢛⣛⣛⣋⣩⣭⣭⣤⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃
                ⠀⠀⠀⣿⡇⠀⠈⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⣶⣶⣶⣶⣶⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠀
                ⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⠀
                ⠀⠀⠀⠀⠀⢠⣤⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠸⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣠⣤⣤⣤⣤⣤⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠋⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠛⠛⠛⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠛⠛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠉⠉⠉⢉⣭⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠛⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
                ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⢿⣿⣿⣿⣿⣿⠿⠿⠟⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀""");

        while (run) {


            System.out.println("=== Welcome ===");
            System.out.println("1 - Character management");
            System.out.println("2 - Start a fight");
            System.out.println("3 - Quit the program");

        }
        choice = scanner.nextInt();
        scanner.nextLine();
        switch (choice) {
            case 1:
                printCharacterMenu();
                break;
            case 2:
                printFightMenu();
                break;
            case 3:
                System.out.println("You quitting the game ! ");
                run = false;
            default:
                System.out.println("Wrong input, the game is over ! ");
                run = false;
        }


    }


    private void printCharacterMenu() throws SQLException {

        while (run) {
            System.out.println("=== Character management ===");
            System.out.println("1 - Make a character ");
            System.out.println("2 - See all characters ");
            System.out.println("3 - Main menu");
        }
        choice = scanner.nextInt();
        scanner.nextLine();
        switch (choice) {
            case 1:
                makeAForceUser();
                break;
            case 2:
                seeAllCharacters();
                break;
            case 3:
                printMenu();
                break;
            default:
                System.out.println("Wrong input ! ");
                printCharacterMenu();
        }


    }


    private void printFightMenu() throws SQLException {

        while (run) {
            System.out.println("=== Fight Menu ===");
            System.out.println("What team do you choose ?");
            System.out.println("1 - SITH");
            System.out.println("2 - REPUBLIC");
            System.out.println("3 - Main menu");

            choice = scanner.nextInt();
            scanner.nextLine();
            switch (choice) {
                case 1:
                    choosingTeam("SITH");
                    break;
                case 2:
                    choosingTeam("REPUBLIC");
                    break;
                case 3:
                    printMenu();
                default:
                    System.out.println("Wrong input ! ");
                    printFightMenu();
            }


        }

    }


    private void makeAForceUser() {

        int newCharacTeam;
        boolean hasLightSaber = false;
        String name;


        System.out.println("Welcome to the character maker !");

        System.out.println("What will be the team side ? ");
        System.out.println("1 - SITH");
        System.out.println("2 - REPUBLIC");
        scanner.nextLine();
        newCharacTeam = scanner.nextInt();
        scanner.nextLine();
        System.out.println("What will be his/her name ? You can put the name or skip");
        name = scanner.nextLine();
        System.out.println("Do he or she has a light saber ? true/false/skip ");
        hasLightSaber = scanner.nextBoolean();
        scanner.nextLine();

        if (forceUserService.makeAForceUser(newCharacTeam, hasLightSaber, name) != null) {
            System.out.println("Your character making is a success ! ");
        } else {
            System.out.println("Something wrong in your character making !  ");
        }
        ;

    }

    private void seeAllCharacters() throws SQLException {
        //show all characters  team  and republic two colonnes

        while (run) {

            List<List<ForceUser>> allForceUsers = forceUserService.getAllForceUser();
            for (List<ForceUser> forceUsers : allForceUsers
            ) {
                for (ForceUser forceUser : forceUsers
                ) {
                    System.out.println(forceUser);
                }
            }

            System.out.println("1. Update a character");
            System.out.println("2. Delete a character");
            System.out.println("3. Go back to previous menu");

            choice = scanner.nextInt();
            scanner.nextLine();
            switch (choice) {
                case 1:
                    updateACharacter();
                    break;
                case 2:
                    deleteACharacter();
                    break;
                case 3:
                    printMenu();
                    break;
                default:
                    System.out.println("Wrong input ! ");
                    seeAllCharacters();
            }

        }

        // menu : update , delete characters
    }

    private void deleteACharacter() throws SQLException {
        int characterId;
        System.out.println("What is the character id to delete ? ");
        characterId = scanner.nextInt();
        scanner.nextLine();

        forceUserService.deleteForceUser(characterId);


    }

    private void updateACharacter() throws SQLException {
        int characterId;
        String newName;
        String hasLightSaber = null;
        Sith.Builder builderSith = new Sith.Builder();
        Jedi.Builder builderJedi = new Jedi.Builder();

        System.out.println("What is the id of the character to update ? ");
        characterId = scanner.nextInt();
        scanner.nextLine();

        System.out.println("What will be his/her name ? You can put the name or skip");
         newName = scanner.nextLine().trim();
        System.out.println("Do he or she has a light saber ? true/false/skip ");
         hasLightSaber = scanner.nextLine().toLowerCase().trim();

        if (forceUserService.findForceUserById(characterId) instanceof Sith) {

            if (hasLightSaber != null && !hasLightSaber.isEmpty()) {
                builderSith.light_saber(Boolean.parseBoolean(hasLightSaber));
            }
            if (newName != null && !newName.isEmpty()) {
                builderSith.name(newName);
            }
            forceUserService.updateForceUserCharacter(characterId, builderSith.build());

        } else if (forceUserService.findForceUserById(characterId) instanceof Jedi) {

            if (hasLightSaber != null && !hasLightSaber.isEmpty()) {
                builderJedi.light_saber(Boolean.parseBoolean(hasLightSaber));
            }
            if (newName != null && !newName.isEmpty()) {
                builderJedi.name(newName);
            }
            forceUserService.updateForceUserCharacter(characterId, builderJedi.build());
        }


    }

    private void choosingTeam(String team) throws SQLException {
    Team chosenTeam = team.equals("SITH") ? Team.SITH : Team.REPUBLIC;
    Game game = Game.getInstance();
    game.playGame(chosenTeam);



    }


}
